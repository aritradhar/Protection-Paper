\section{Security Analysis}
\label{sec:securityAnalysis}

%In this section, we analyze the security of \name by modeling the interaction between the user, host, and the remote server.


\myparagraph{Modelling the user behavior} Correctly understanding the user behavior is critical as \name focuses on securing user interaction with the remote server. In Section~\ref{sec:systemDesign:userAttention}, we explain how to focus user attention using techniques such as lightbox or freezing. Note that these mechanisms are activated automatically for IO integrity by the \device when the user enters the sensitive UI. However, for IO confidentiality, as we discussed in Section~\ref{sec:confidentiality:SAS}, \name requires secure attention sequence (SAS) to be activated by the user. SAS enables the user to i) recognize which part of the screen is overlaid by the \device, and ii) follow the legitimate mouse pointer. We assume that the user behaves reasonably, hence the SAS mechanism is sufficient to isolate the trusted part of the screen (\device overlay) from the untrusted part of the screen. We also agree that system like \name may not achieve absolute security as the user may choose to ignore all visual cues made by the \device and choose to follow the untrusted notifications from the host. Therefore, as long as the user does not get influenced by the information provided in the untrusted part of the screen and modifies her input, the \name remains secure.\red{Assumption is vague, could be interpreted at extremes.}

Next, what follows are the informal security analysis of the integrity and confidential properties of \name. Due to space constraints, we provide formal proofs in Appendix~\ref{appendix:security}.


\subsection{Integrity}
\label{sec:securityAnalysis:integrity}

\myparagraph{Interdependency of input and output integrity}  We model the interactions between the user, the remote server and the attacker-controlled host as a finite state machine (FSM) that is depicted in Figure~\ref{fig:fsm} in Appendix~\ref{appendix:security:protocol}. The nodes in the FSM, namely \user, \server, and \host denote the user, server, and the host, respectively. The state transition happens when a node delivers a packet to another node. $m$ defined the message that is sent by \server to \host. $m$ contains the HTTP response (HTML, \js etc.) from the server. $[m']$ denotes the transformation of $m$, that is the webpage rendered by the host. Note that for an honest host, $[m]$ denotes the ideal transformation of $m$. We provide more details about this interaction in Appendix~\ref{appendix:security:protocol}.
Definition~\ref{def:inputIntegrity} and~\ref{def:outputIntegrity} provides the formal definition of input and output integrity respectively. In Theorem~\ref{theorem:th1}, ~\ref{theorem:th2}. and ~\ref{theorem:th3} we prove that as long as user reports everything that she sees on display to the remote server alongside her input over an authenticated channel, input integrity could be achieved. \name ensures output integrity the \device overlays the sensitive UI on the screen. By doing so, \name also ensures input and integrity simultaneously. 

\myparagraph{Changing IO signals} As only the \device can interact with the overlaid UI, the attacker can not manipulate the IO signals inside the overlaid UI. Moreover, the attacker can not generate and submit input data to the remote server as the server requires all the input data to be signed by the \device.

\myparagraph{Attack on the mouse pointer tracking and overlay} 
The attacker may try to defeat the \name pointer tracking and overlay mechanism described in Section~\ref{sec:systemDesign:analysis} by introducing a malicious pointer that is visually more appealing to the user. Note that the \device overlaid mouse pointer is prominent and hard to miss. One can visualize it as an arms race between the attacker and the \device to grab the attention of the user. But, we can argue that this is a suboptimal strategy for the attacker as both of the pointers will be visible on the screen that can cause suspicion to the user. Also, when the real mouse pointer enters the overlaid area, the untrusted part, including the malicious mouse pointer, will be hidden by the focusing mechanism. Hence, we can conclude that executing clickjacking-like attacks is not possible in \name.

\myparagraph{Early form submission} This attack is not possible as all the input (both mouse and keyboard) are connected to the \device and only the \device can interact with the overlaid UI. This makes it impossible for the attacker to emulate a click on the overlaid part of the screen.  

\myparagraph{Replay attack} All the sensitive UI elements from the remote server contain freshness value (nonce) alongside the signature. Hence, the replay attack is not possible.

\myparagraph{Not rendering QR code} The host may deny sending the QR code over the HDMI channel. This is considered as a denial of service, which is acceptable in our threat model as long as the user interacts with a compromised host. 
In any case, the host is not able to alter any user input or access encrypted data when \name with the confidential feature is required.
%However, the \device cannot observe and decode the encoded UI. As the remote server only accepts signed inputs from the \device corresponding to the sensitive UI, the host can not submit arbitrary input values to the remote server.

\myparagraph{Malicious instruction on the screen} The attacker may put malicious instruction/labels on the untrusted part of the screen to influence user inputs. However, when the user enters inside the overlaid UI to send inputs, the focusing mechanism highlights only the secure UI and hides the rest of the screen. 
%The user attention focusing mechanisms enable the user to distinguish the trusted part of the screen from the untrusted part.

\subsection{Confidentiality}

\myparagraph{Redirection} The attacker could redirect the user to a phishing website that renders visually identical UI to that of the legitimate website. Redirection attack cannot break the integrity of the input because a legitimate remote server always requires the signed input from the user. Without a valid signed QR code, the \device never signs the input value. 

The remote server also delivers confidential information only after creating a \tls channel with the user's device. Therefore, if the attacker redirects the user to a malicious page, the legit server does not deliver any information. On the other hand, redirection may compromise only the confidentiality of user inputs if the user does not trigger the SAS mechanism. 
%as the confidentiality of inputs requires the user to manually trigger the SAS to detect any sensitive UI elements that are overlaid by the \device.

\myparagraph{Side-channel leakages} Even though, the \device ensures that no mouse, keyboard events arrive at the untrusted host when the user executes some operation over the overlaid UI, one can not rule out all side-channel leakages. Depending on the application, the amount of time that the user spends or the entry/exit position of the mouse pointer may reveal some information to the attacker. 
\device could allow the remote server to specify additional policies in the specification to prevent side-channel attacks, e.g., a minimum amount of time that the device should not forward any event to the host after the user enters the overlay. We leave as future work defining such policies and implementing them on \name.
%However, for fixed length inputs such as the pin codes or credit card details, do not leak any information about the input.


\myparagraph{Attacks toward \device} In \name trust model, we assume that the \device is trusted. However, in real-world, embedded systems are often vulnerable to attacks as the attacker can use the connection interfaces to reprogram the \device. In our case, the \device has only two interfaces with the host. The HDMI controller on the \device does not support any bidirectional data channel. Hence, the attacker cannot exploit the HDMI interface. The \usb interface on the \device is only unidirectional (\device $\rightarrow$ host) as the \device emulates itself as an HID. Hence the attacker also cannot exploit the \usb interface.  
